# Wk08 - Identity Management

[Back](../index.md)

- [Wk08 - Identity Management](#wk08---identity-management)
  - [Authentication Servers](#authentication-servers)
    - [](#)
    - [NTLM (NT LAN Manager)](#ntlm-nt-lan-manager)
    - [Kerberos](#kerberos)
  - [SPN – Service Principal Names](#spn--service-principal-names)
    - [Kerberos Delegated Authentication](#kerberos-delegated-authentication)
    - [Service Accounts](#service-accounts)
    - [MSA (Managed Service Accounts)](#msa-managed-service-accounts)
    - [Group Managed Service Accounts](#group-managed-service-accounts)

---

## Authentication Servers

###

- `AAA–Authentication,Authorization,Accounting server`

  - “the act of confirming the identity of a user or system”
  - We need to trust the process we use to confirm the identity of a user or system.

- `RADIUS AAA Server`
  - `Remote Authentication Dial-in User Service` (an old name!)

---

- Types of Windows Authentication Services

1. `Kerberos` (**Default**)
2. `NTLM` (Fallback if Kerberos is unavailable)
3. `TLS/SSL` and `Digest`

---

### NTLM (NT LAN Manager)

- `NT (New Technology) LAN Manager (NTLM)`

  - a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users.

- Used in an Active Directory environment **only when Kerberos is not available** or when applications do not support it.
- Provides **Backward Compatibility** to workgroup members
- Application must connect to DC for every service.
- Uses Challenged Response

1. Server Sends an 8-byte Challenge Message to Client
2. Client uses the password as a key to encrypt the 8-Byte Message using **Hash** and `DES`.
3. Server knows what the clients key should be.
   if the server can successfully decrypt the message using the password
   **and**
   check the hash value matches the hash value of the 8-Byte Message originally sent, user is then **authenticated**.

---

### Kerberos

- There are **three** components to Kerberos:
  - the **client**,
  - a **service**
  - and a **third-party** that both client and service trust.
- Kerberos is "… an **authentication protocol** for trusted clients on untrusted networks.“ (F. Ricardi)
- Similar in scope to `SSL/TLS` – Encryption, Hashing and Authentication **using a shared secret key** and a **certificate authority** for verification of untrusted clients and servers.
- Kerberos is then very effective on a trusted corporate network with trusted clients.
- A shared secret key is generated from credentials and a **ticket** is issued for verification and authentication.

---

- **Default** method used in an Active Directory Environment
- More efficient authentication to servers.
  - **Renewable session tickets** replace pass-through authentication
  - No DC request required (unless it needs to validate a Privilege Attribute Certificate (PAC))
  - `Single Sign On` in a forest set through a GPO.
  - Interoperability with Linux and others, IETF compliant.
- **Mutual authentication** – both client and server authenticate the identity of each other.
- Uses **Ticketing** to authenticate client/server.
- Clients re-use credential for entire session

---

- **After Authentication**

- The `client` **retains the Ticket** and uses it for each sub-sequential authentication request to that particular service.
  - Which ticket are we referring to here? Review last week lecture notes for ticketgranting ticket and service-granting ticket.
- This means – you do not need to continue to authenticate with the DC each time.
- For this reason, the ticket must have an **expiration** – set in **GPO**, default is **10** Hours.
- Kerberos requires the system time to be within (by default) **5 minutes** of each other – default can be changed in Group Policy.

---

## SPN – Service Principal Names

- Kerberos uses `SPN` to **identify a service**.
  - e.g., `HTTP/intranet.fanco.com`
  - Contains the **service class** (such as HTTP)
  - Contains the **host name** (intranet.fanco.com in this case)
  - Contains the **Port** (if port 80 is not being used)
- An SPN should be created for the `NetBIOS` and the `FQDN` host name.
- SPN are **attributes** of objects in Active Directory
  - Can useADSIEdit
  - Or Active Directory Users and Computers

---

### Kerberos Delegated Authentication

- Allow a **ticket to be created** for **another** service **on the user’s behalf**.
- Delegation is configured in AD Users & Computers (MMC Snap-in)

---

### Service Accounts

- Set-up like a user account plus a SPN for the account
- **Dependent** on `Kerberos` encryption types
- Most Services can run under one of the default accounts (Local Service, NetworkService or LocalSystem).
  - This way, a compromised service can do only limited damage.
- If you need / or would like a service to run under **different credentials** so it can access specific resources you can:

  1. Create an Active Directory **User Object** with a Password
  2. **Authorize** the User Account as Necessary
  3. **Configure the Service** to run as this newly created user
  4. **Restart** the Service

---

- **Drawbacks** with Creating ServiceAccounts

  - Either Passwords are set to **never expire** (Which is not recommended) or the **service will stop** working when the password expires.
  - Resetting Service Account passwords must be in tandem with setting the password on the service.
  - For best security, Services should not be run on DCs and avoid multiple services on a DC or single server.

---

### MSA (Managed Service Accounts)

- MSAs are **stored** in `Active Directory` and have **passwords**.
  - However, a random, complex 240 character passwords and regenerates the password every **30 days**.
- Services do **not need to be updated** when these passwords change.
- MSAs **cannot login** interactively
- **Drawbacks**:

  - **Cannot** be locked **out** – mitigated by complex password changing every 30 days.
  - MSA’s **cannot span** multiple computers
  - The MSA Object is a “user” & “computer” at once, but is **not** an AD **“person”**
  - An MSA must be **created** for **each server**, cannot use the same MSA for more than one server – so **clustered servers** cannot use MSAs.

---

### Group Managed Service Accounts





- AAA/ RADIUS Servers
- NTLM
- Kerberos
- Service Principle Names
- Kerberos DelegatedAuthentication
- ServiceAccounts
- Managed ServiceAccounts
- Group Managed ServiceAccounts
- Network Policy Server
- NPS as RADIUS
- NPSAuthentication
- NPS Policies
- Routing and RemoteAccess Service
- NPSAuthentication
- Other Policy Types
- SubjectAlternative Names / Certificates
